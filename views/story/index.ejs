<%
%>

<h1>Stories</h1>

<p id="story-links">
  <span class="clickable-link main-link">+ New Story</span>
  <span class="clickable-link main-link" onClick="showConvertForm()">Convert Stories</span>
</p>

<div id="convert-form" style="display: none;">
  <form method="POST" action="/stories/convert">
    Toggle story/source
    <input type="text" name="sourceId">
    <button>convert</button>
    <span class="clickable-link" onClick="cancelConvertForm()">cancel</span>
  </form>
</div>

<table class="info-table">
  <tr>
    <th>type</th>
    <th>group</th>
    <th>title</th>
    <th>date</th>
    <th>location</th>
    <th>notes</th>
    <th>sharing</th>
  </tr>

  <% stories.forEach(story => { %>
    <%
      const storyNotes = (story.notes || '').length ? story.notes.split('\n') : [];
    %>

    <tr>
      <td>
        <%= story.type %>
      </td>
      <td>
        <%= story.group %>
      </td>
      <td>
        <%- include('../partials/linkToStory', { story: story }) %>
      </td>
      <td>
        <%- include('../format/date', { params: {
          date: story.date,
        }}) %>
      </td>
      <td>
        <%- include('../format/location', { params: {
          location: story.location,
        }}) %>
      </td>
      <td>
        <% storyNotes.forEach(str => { %>
          <p><%= str %></p>
        <% }); %>
      </td>
      <td>
        <img class="checkmark-inline" src="/images/check-<%= story.sharing %>.png">
      </td>
    </tr>
  <% }); %>
</table>

<script>
  function showConvertForm() {
    $('#story-links').hide();
    $('#convert-form').show();
  }

  function cancelConvertForm() {
    $('#story-links').show();
    $('#convert-form').hide();
  }
</script>
