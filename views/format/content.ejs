<style>
    .text-content .full-view {
        display: none;
    }
</style>

<script>
    function showMore(clickedItem) {
        var $link = $(clickedItem);
        var $div = $link.closest('div');
        $div.find('.cropped-view').remove();
        $div.find('.full-view').removeClass('full-view');
    }
</script>

<%
    var characterLimit = 500;
    var fullArr = [];
    var croppedArr = [];
    var isCropped = false;

    if (content) {
        if (limit) {
            if (content.length > characterLimit) {
                isCropped = true;
                var content2 = content.slice(0, characterLimit) + '...';
                croppedArr = content2.split('\n');
            }
        }
        fullArr = content.split('\n');
    }
%>

<div class="text-content">
    <% if (isCropped) { %>
        <% croppedArr.forEach((str, i) => { %>
            <p class="cropped-view">
                <%= str %>
                <% if (isCropped && i == croppedArr.length - 1) { %>
                    <a class="clickable-link" onClick="showMore(this)">show more</a>
                <% }%>
            </p>
        <% }); %>
        <% fullArr.forEach((str, i) => { %>
            <p class="full-view">
                <%= str %>
            </p>
        <% }); %>
    <% } else { %>
        <% for (var i = 0; i < fullArr.length; i++) { %>
            <%
                var str = fullArr[i];
                var isTable = str.length > 0 && str.slice(0, 1) == '\|';
            %>
            <% if (isTable) { %>
                <table border="1">
                    <tr>
                        <% while (true) { %>
                            <%
                                var isHeader = false;
                                var cellContent = '';

                                if (str.length > 1 && str.slice(0, 2) == '\|\|') {
                                    isHeader = true;
                                    str = str.slice(2).trim();
                                } else {
                                    str = str.slice(1).trim();
                                }

                                if (str.match('\|')) {
                                    var index = str.indexOf('\|');
                                    cellContent = str.slice(0, index);
                                    str = str.slice(index);
                                } else {
                                    cellContent = str;
                                    str = '';
                                }
                            %>
                            <% if (isHeader) { %>
                                <th>
                                    <%= cellContent %>&#160;
                                </th>
                            <% } else { %>
                                <td>
                                    <%= cellContent %>&#160;
                                </td>
                            <% } %>
                            <%
                                if (str == '') {
                                    break;
                                }
                            %>
                        <% } %>
                    </tr>
                </table>
            <% } else { %>
                <p>
                    <%= str %>
                </p>
            <% } %>
        <% } %>
    <% } %>
</div>
