<%
  const rootPath = '/sources';
  const newSourcePath = rootPath + '/new';
  const showAllTypes = subView == 'none' || subView == 'new';
%>

<h1>Sources</h1>

<% if (showNew) { %>
  <%- include('../forms/newSource', {
    actionPath: newSourcePath,
    cancelPath: rootPath,
  }) %>
<% } else { %>
  <p>
    <a href="/sources/new" class="main-link">+ New Source</a>
  </p>
<% } %>

<ul class="bullet-list">
  <li>
    <a href="/sources">all</a>
  </li>
  <% mainSourceTypes.forEach(sourceType => { %>
    <%
      let sourceTypeText = sourceType;

      if (sourceType == 'index') {
        sourceTypeText = 'web index';
      }
    %>
    <li>
      <a href="/sources/<%= sourceType %>"><%= sourceTypeText %></a>
    </li>
  <% }); %>
</ul>

<table class="info-table">
  <tr>
    <th>t</th>
    <th>story</th>
    <th>title</th>
    <th>date</th>
    <th>location</th>
    <th>sharing</th>
  </tr>

  <% sources.forEach(source => { %>
    <%
      const typeMatches = source.type == source.story.type
        || (source.type == 'grave' && source.story.type == 'cemetery')
        || (source.type == 'photo' && source.story.title == 'Photo')
        || (source.type == 'article' && source.story.type == 'website');
    %>
    <tr>
      <td>
        <% if (!typeMatches) { %>
          <%= source.type %>
        <% } %>
      </td>

      <td>
        <% if (source.story) { %>
          <%- include('../partials/linkToStory', {
            story: source.story,
          }) %><br>
        <% } %>
      </td>

      <td>
        <%- include('../partials/linkToSource', {
          source: source,
          showGroup: false,
        }) %>
      </td>

      <td>
        <%- include('../format/date', { params: {
          date: source.date,
        }}) %>
      </td>

      <td>
        <%- include('../format/location', { params: {
          location: source.location,
        }}) %>
      </td>

      <td>
        <img class="checkmark-inline" src="/images/check-<%= source.sharing %>.png">
        <% if (source.sharing && source.story && !source.story.sharing) { %>
          <span style="color: red">WARNING: story not shared</span>
        <% } %>
      </td>
    </tr>
  <% }); %>
</table>
