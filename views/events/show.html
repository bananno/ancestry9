<%- include ../partials/header %>

<% var rootPath = '/event/' + event._id; %>

<div id="content">
    <h1><%= event.title %></h1>

    <table border="1">

        <!-- TITLE -->

        <%
            var editTitlePath = rootPath + '/editTitle';
        %>

        <tr>
            <td>
                <b>title</b>
            </td>
            <form action="<%= editTitlePath %>" method="POST">
                <td>
                    <% if (editField == 'title') { %>
                        <input type="text" value="<%= event.title %>" name="title">
                    <% } else { %>
                        <%= event.title %>
                    <% } %>
                </td>
                <td>
                    <% if (editField == 'title') { %>
                        <input type="hidden" value="PUT" name="_method">
                        <button type="submit">save</button>
                        <a href="<%= rootPath %>">cancel</a>
                    <% } else if (editField == 'none') { %>
                        <a href="<%= editTitlePath %>">edit</a>
                    <% } %>
                </td>
            </form>
        </tr>

        <!-- DATE -->

        <%
            var editDatePath = rootPath + '/editDate';
        %>

        <tr>
            <td>
                <b>date</b>
            </td>
            <form action="<%= editDatePath %>" method="POST">
                <td>
                    <% if (editField == 'date') { %>
                        <%- include('../forms/date', { date: event.date }) %>
                    <% } else { %>
                        <%- include('../format/date', {date: event.date}) %>
                    <% } %>
                </td>
                <td>
                    <% if (editField == 'date') { %>
                        <input type="hidden" value="PUT" name="_method">
                        <button type="submit">save</button>
                        <a href="<%= rootPath %>">cancel</a>
                    <% } else if (editField == 'none') { %>
                        <a href="<%= editDatePath %>">edit</a>
                    <% } %>
                </td>
            </form>
        </tr>

        <!-- LOCATION -->

        <%
            var editLocationPath = rootPath + '/editLocation';
        %>

        <tr>
            <td>
                <b>location</b>
            </td>
            <form action="<%= editLocationPath %>" method="POST">
                <td>
                    <% if (editField == 'location') { %>
                        <%- include('../forms/location', { location: event.location }) %>
                    <% } else { %>
                        <%- include('../format/location', { location: event.location }) %>
                    <% } %>
                </td>
                <td>
                    <% if (editField == 'location') { %>
                        <input type="hidden" value="PUT" name="_method">
                        <button type="submit">save</button>
                        <a href="<%= rootPath %>">cancel</a>
                    <% } else if (editField == 'none') { %>
                        <a href="<%= editLocationPath %>">edit</a>
                    <% } %>
                </td>
            </form>
        </tr>

        <!-- PEOPLE -->

        <%
            var numberOfPeople = event.people.length;
            var addPersonPath = rootPath + '/addPerson';
            var deletePersonPath = rootPath + '/deletePerson/';
        %>

        <% for (var p = 0; p < numberOfPeople + 1; p++) { %>
            <tr>
                <td>
                    <% if (p == 0) { %>
                        <b>people</b>
                    <% } %>
                </td>
                <% if (p < numberOfPeople) { %>
                    <% let person = event.people[p]; %>
                    <form action="<%= deletePersonPath %><%= person.id %>" method="POST"
                            onsubmit="return confirmDeletion('person from event')">
                        <td>
                            <%- include('../partials/linkToPerson', {person: person}) %>
                        </td>
                        <td>
                            <% if (editField == 'none') { %>
                                <input type="hidden" value="PUT" name="_method">
                                <button type="submit">delete</button>
                            <% } %>
                        </td>
                    </form>
                <% } else if (editField == 'none') { %>
                    <td>
                        <a href="<%= addPersonPath %>">add</a>
                    </td>
                    <td>
                    </td>
                <% } else if (editField == 'people') { %>
                    <form action="<%= addPersonPath %>" method="POST">
                        <td>
                            <%- include('../forms/personDropdown', { params: {
                                name: 'people',
                                selected: null,
                            }}) %>
                        </td>
                        <td>
                            <input type="hidden" value="PUT" name="_method">
                            <button type="submit">save</button>
                            <a href="<%= rootPath %>">cancel</a>
                        </td>
                    </form>
                <% } %>
            </tr>
        <% } %>

        <!-- NOTES -->

        <%
            var editNotesPath = rootPath + '/edit/notes';
        %>

        <tr>
            <td>
                <b>notes</b>
            </td>
            <form action="<%= editNotesPath %>" method="POST">
                <td>
                    <% if (editField == 'notes') { %>
                        <input type="text" value="<%= event.notes %>" name="notes">
                    <% } else { %>
                        <%= event.notes %>
                    <% } %>
                </td>
                <td>
                    <% if (editField == 'notes') { %>
                        <input type="hidden" value="PUT" name="_method">
                        <button type="submit">save</button>
                        <a href="<%= rootPath %>">cancel</a>
                    <% } else if (editField == 'none') { %>
                        <a href="<%= editNotesPath %>">edit</a>
                    <% } %>
                </td>
            </form>
        </tr>

        <!--  -->
    </table>

    <% if (editField == 'none') { %>
        <form action="<%= rootPath %>/delete" method="POST" onsubmit="return confirmDeletion('event')">
            <p>
                <input type="hidden" value="PUT" name="_method">
                <button type="submit">delete event</button>
            </p>
        </form>
    <% } %>
</div>
